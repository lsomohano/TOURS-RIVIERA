<%- include('../../partials/titles', { title: 'Editar tour', botones: botones }) %>
<%- include('../../partials/messages') %>

<section class="content">
  <div class="card">
    <div class="card-body">
      <form action="/admin/tours/<%= tour.id %>/edit" method="POST" enctype="multipart/form-data">
        
        <div class="form-group">
          <label>Nombre</label>
          <input type="text" class="form-control" name="nombre" value="<%= tour.nombre %>" required>
        </div>

        <div class="form-group">
          <label>Descripción</label>
          <textarea class="form-control" name="descripcion" rows="3"><%= tour.descripcion %></textarea>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6">
            <label>Lugar de salida</label>
            <input type="text" class="form-control" name="lugar_salida" value="<%= tour.lugar_salida %>">
          </div>
          <div class="form-group col-md-6">
            <label>Lugar de destino</label>
            <input type="text" class="form-control" name="lugar_destino" value="<%= tour.lugar_destino %>">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-4">
            <label>Duración (días)</label>
            <input type="number" class="form-control" name="duracion" value="<%= tour.duracion %>">
          </div>
          <div class="form-group col-md-4">
            <label>Tipo</label>
            <select class="form-control" name="tipo">
              <option value="aventura" <%= tour.tipo === 'aventura' ? 'selected' : '' %>>Aventura</option>
              <option value="relajacion" <%= tour.tipo === 'relajacion' ? 'selected' : '' %>>Relajación</option>
              <option value="cultural" <%= tour.tipo === 'cultural' ? 'selected' : '' %>>Cultural</option>
            </select>
          </div>
          <div class="form-group col-md-4">
            <label>Modalidad</label>
            <select class="form-control" name="modalidad">
              <option value="grupo" <%= tour.modalidad === 'grupo' ? 'selected' : '' %>>Grupo</option>
              <option value="privado" <%= tour.modalidad === 'privado' ? 'selected' : '' %>>Privado</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-4">
            <label>Idioma</label>
            <input type="text" class="form-control" name="idioma" value="<%= tour.idioma %>">
          </div>
          <div class="form-group col-md-4">
            <label>Precio</label>
            <input type="number" step="0.01" class="form-control" name="precio" value="<%= tour.precio %>">
          </div>
          <div class="form-group col-md-4">
            <label>Cupo máximo</label>
            <input type="number" class="form-control" name="cupo_maximo" value="<%= tour.cupo_maximo %>">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6">
            <label>Fecha inicio</label>
            <input type="date" class="form-control" name="fecha_inicio" value="<%= tour.fecha_inicio?.toISOString().split('T')[0] %>">
          </div>
          <div class="form-group col-md-6">
            <label>Fecha fin</label>
            <input type="date" class="form-control" name="fecha_fin" value="<%= tour.fecha_fin?.toISOString().split('T')[0] %>">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6">
            <% if (tour.imagen_destacada) { %>
            <div class="form-group">
                <label>Imagen destacada actual</label><br>
                <img src="<%= tour.imagen_destacada %>" width="150" class="img-thumbnail mb-2">
            </div>
            <% } %>

            <div class="form-group">
                <label for="imagen_destacada">Imagen destacada</label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="imagen_destacada" name="imagen_destacada" accept="image/*">
                    <label class="custom-file-label" for="imagen_destacada">Selecciona una imagen</label>
                </div>
            </div>
          </div>
          <div class="form-group col-md-6">
            <div class="form-group form-check">
                <input type="checkbox" class="form-check-input" name="disponible" value="1" <%= tour.disponible ? 'checked' : '' %>>
                <label class="form-check-label">Disponible</label>
            </div>
          
            <div class="form-group form-check">
                <input type="checkbox" class="form-check-input" name="publicado" value="1" <%= tour.publicado ? 'checked' : '' %>>
                <label class="form-check-label">Publicado</label>
            </div>
          </div>
          
        </div>

        <button type="submit" class="btn btn-primary btn-block">Guardar cambios</button>
      </form>
    </div>
  </div>
</section>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const fileInputs = document.querySelectorAll('.custom-file-input');
    fileInputs.forEach(input => {
      input.addEventListener('change', function () {
        const fileName = this.files[0]?.name || 'Selecciona una imagen';
        this.nextElementSibling.innerText = fileName;
      });
    });
  });
</script>
